# AI寻路系统使用说明

## 🤖 AI寻路系统概述

本项目新增了一套完整的AI寻路系统，使AI角色能够智能地在多层平台环境中移动，包括跳跃、下落和蹲下穿越等复杂移动方式。

## 🏗️ 系统架构

### 核心组件

1. **NavigationNode** - 导航节点
   - 表示地图上可移动的位置点
   - 支持地面、平台、跳跃、下落、蹲下等不同类型节点
   - 使用A*算法进行路径寻找

2. **PathFinder** - 路径寻找器
   - 基于A*算法实现最优路径寻找
   - 自动生成导航网格
   - 支持复杂地形的路径规划

3. **AIController** - AI控制器
   - 管理AI角色的行为状态机
   - 实现智能决策和目标选择
   - 控制角色的移动、攻击、拾取等行为

## 🎮 游戏中的使用方法

### 启用/禁用AI
- 按 **F1** 键：启用或禁用AI控制
  - AI启用时：enemy角色由AI控制，会自动寻路、战斗、拾取物品
  - AI禁用时：enemy角色恢复手动控制（方向键+NM）

### AI目标设置
- 按 **F2** 键：让AI角色移动到玩家位置
- AI会自动选择最优路径到达目标位置

### AI行为特性
- **智能战斗**：AI会主动寻找并攻击玩家角色
- **物品收集**：AI会自动拾取武器和药物
- **战术撤退**：血量过低时会寻找安全位置
- **多层平台导航**：能够跳跃到不同平台、蹲下穿越草地平台

## 🎯 AI移动能力

### 支持的移动方式
1. **步行移动** - 在同一平台上的水平移动
2. **跳跃移动** - 跳跃到更高的平台或跨越间隙
3. **下落移动** - 从高处下落到低处平台
4. **蹲下穿越** - 在草地平台上蹲下穿越到下层

### 路径寻找特性
- **最优路径**：使用A*算法找到代价最小的路径
- **物理模拟**：考虑跳跃物理和重力影响
- **障碍避免**：绕过墙体和其他障碍物
- **多层支持**：在复杂多层地图中导航

## 🔧 技术特点

### 导航网格生成
- 自动分析地图结构
- 在平台上生成导航节点
- 建立节点间的连接关系

### 智能行为系统
- 状态机管理（空闲、移动、跳跃、攻击等）
- 目标优先级评估
- 动态路径重计算

### 性能优化
- 距离预筛选减少计算量
- 路径缓存避免重复计算
- 定时更新机制

## 🎲 AI配置参数

AI系统提供了丰富的配置选项：

```cpp
// 更新频率
updateInterval = 100.0ms        // AI更新间隔
pathRecalculationInterval = 2s  // 路径重算间隔

// 移动参数
arrivalThreshold = 30.0px       // 到达目标阈值
searchRadius = 400.0px          // 搜索半径
combatRange = 120.0px           // 战斗范围

// 行为参数
reactionTime = 500ms            // 反应时间
retreatHealthThreshold = 20HP   // 撤退血量阈值
enableCombat = true             // 启用战斗
enableItemCollection = true     // 启用物品收集
```

## 🔍 调试功能

### 调试信息
- AI状态实时显示
- 路径寻找日志
- 行为决策记录

### 调试命令
- 启用调试：`aiController->setDebugEnabled(true)`
- 查看导航节点：`pathFinder->debugPrintNavigation()`

## 🚀 扩展可能性

### 当前支持的功能
- ✅ 多层平台导航
- ✅ 智能战斗系统
- ✅ 物品收集行为
- ✅ 蹲下穿越草地平台
- ✅ 物理模拟跳跃

### 未来扩展方向
- 🔮 更复杂的战斗策略
- 🔮 团队协作AI
- 🔮 学习型AI行为
- 🔮 动态难度调整
- 🔮 更多地图元素支持

## 📝 使用示例

```cpp
// 在BattleScene中的基本用法

// 1. 初始化AI系统（自动在构造函数中完成）
initializeAI();

// 2. 启用AI
enableAI(true);

// 3. 设置AI目标
setAITargetCharacter(enemy, player);  // 让AI追踪玩家
setAITarget(enemy, QPointF(x, y));    // 让AI移动到指定位置

// 4. 检查AI状态
bool aiActive = isAIEnabled();
AIController::AIState state = aiController->getCurrentState();
```

这套AI系统为游戏提供了强大的智能NPC控制能力，使得游戏体验更加丰富和挑战性。AI角色能够像真实玩家一样在复杂的多层平台环境中移动和战斗。
